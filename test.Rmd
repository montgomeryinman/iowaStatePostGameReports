---
title: "test"
author: "Montgomery Inman"
date: "2024-08-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(cfbfastR)
library(cfbplotR)
library(tidyverse)
library(gt)
```

Pull Data:

```{r}
team = "Iowa State"
year = 2023
week = 12

#Getting pbp data
pbp = cfbd_pbp_data(year = year, team = team, week = week, epa_wpa = F) %>%
  filter(down > 0)

#Getting gameid for the game
gameid = pbp$game_id[1]

#Getting advanced game log data
advancedBox = cfbd_game_box_advanced(gameid, long = F) 

#Getting game team stats
teamStats = cfbd_game_team_stats(year = year, game_id = gameid)
teamStats = teamStats %>% separate_wider_delim(completion_attempts, delim = "-", names = c("completions", "attempts"))
teamStats = teamStats %>% separate_wider_delim(third_down_eff, delim = "-", names = c("thirdDownCompleted", "thirdDownAttempts"))
```


Make gt() table:

```{r}
homeTeamStats = teamStats %>% filter(home_away == "home")
awayTeamStats = teamStats %>% filter(home_away == "away")

homeAdvBox = advancedBox %>% filter(team == pbp$home[1])
awayAdvBox = advancedBox %>% filter(team == pbp$away[1])

dfForGt = data.frame(
  "Stat" = c("Team", 
             "Score",
             "EPA / Play",
             "Yards / Play",
             "Success Rate",
             "Poss Time",
             "EPA / Pass",
             "Yards / Pass",
             "Completion %",
             "Attempts",
             "Yards",
             "EPA / Rush",
             "Yards / Rush",
             "Stuff Rate",
             "Attempts",
             "Yards",
             "First Downs",
             "Third Down %"
  ),
  "Home" = c(pbp$home[1], 
             homeTeamStats$points,
             NA,
             as.numeric(homeTeamStats$total_yards) / homeAdvBox$ppa_plays, 
             homeAdvBox$success_rates_overall_total,
             homeTeamStats$possession_time,
             NA,
             homeTeamStats$yards_per_pass,
             as.numeric(homeTeamStats$completions) / as.numeric(homeTeamStats$attempts),
             homeTeamStats$attempts,
             homeTeamStats$net_passing_yards,
             NA,
             homeTeamStats$yards_per_rush_attempt,
             homeAdvBox$rushing_stuff_rate,
             homeTeamStats$rushing_attempts,
             homeTeamStats$rushing_yards,
             homeTeamStats$first_downs,
             as.numeric(homeTeamStats$thirdDownCompleted) / as.numeric(homeTeamStats$thirdDownAttempts)),
  "Away" = c(pbp$away[1],
             awayTeamStats$points,
             NA,
             as.numeric(awayTeamStats$total_yards) / awayAdvBox$ppa_plays,
             awayAdvBox$success_rates_overall_total,
             awayTeamStats$possession_time,
             NA,
             awayTeamStats$yards_per_pass,
             as.numeric(awayTeamStats$completions) / as.numeric(awayTeamStats$attempts),
             awayTeamStats$attempts,
             awayTeamStats$net_passing_yards,
             NA,
             awayTeamStats$yards_per_rush_attempt,
             awayAdvBox$rushing_stuff_rate,
             awayTeamStats$rushing_attempts,
             awayTeamStats$rushing_yards,
             awayTeamStats$first_downs,
             as.numeric(awayTeamStats$thirdDownCompleted) / as.numeric(awayTeamStats$thirdDownAttempts))
)

```

Calculate percentiles for color grading gt():
```{r}
combined_data_team_stats <- data.frame()
weeksForPercentiles = c(1:15)

for (weeks in weeksForPercentiles) {
  temp = cfbd_game_team_stats(
  year = 2023,
  week = weeks,
  season_type = "regular",
  team = NULL,
  conference = NULL,
  game_id = NULL,
  rows_per_team = 1
  )
  
  combined_data_team_stats <- rbind(combined_data_team_stats, temp)
}

str(combined_data_team_stats)
```


Make Win Probability Chart:

```{r}

```


Combine:

```{r}

```









